(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(4662)}])},4662:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var n=s(5893);s(5675);var r=s(9008),l=s.n(r),a=s(7294);function c(e){let{children:t,color:s=""}=e;return(0,n.jsx)("div",{className:"bg-blue-500 w-[45px] h-[45px] flex items-center justify-center rounded-full",style:{backgroundColor:s},children:(0,n.jsx)("span",{className:"font-bold text-sm text-white",children:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e.includes(" ")){let t=e.split(" ");return"".concat(t[0].charAt(0)).concat(t[1].charAt(0)).toUpperCase()}return"".concat(e.slice(0,2)).toUpperCase()}(t)})})}async function i(){try{return(await fetch("http://localhost:8080/rooms")).json()}catch(e){return console.log(e),Promise.resolve(null)}}function o(e){let{onSelect:t,room:s,userId:r,index:l,selectedItem:a}=e,{users:i,created_at:o,last_message:u,name:d}=s,x=l==a,h=new Date(o),m=h.getHours()>=12?"PM":"AM",f="".concat(h.getHours(),":").concat(h.getMinutes()," ").concat(m);return null==i||i.filter(e=>e.id!=r).map(e=>e.username)[0],(0,n.jsx)("div",{onClick:()=>t(l,{}),className:"".concat(x?"bg-[#FDF9F0] border border-[#DEAB6C]":"bg-[#FAF9FE] border border-[#FAF9FE]"," p-2 rounded-[10px] shadow-sm cursor-pointer"),children:(0,n.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex gap-3 items-center w-full",children:[(0,n.jsx)(c,{children:d}),(0,n.jsxs)("div",{className:"w-full max-w-[150px]",children:[(0,n.jsx)("h3",{className:"font-semibold text-sm text-gray-700",children:d}),(0,n.jsx)("p",{className:"font-light text-xs text-gray-600 truncate",children:u})]})]}),(0,n.jsx)("div",{className:"text-gray-400 min-w-[55px]",children:(0,n.jsx)("span",{className:"text-xs",children:f})})]})})}function u(e){let{onChatChange:t,userId:s}=e,[r,l]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1),[d,x]=(0,a.useState)(-1);(0,a.useEffect)(()=>{u(!0),i().then(e=>{console.log(e),l(e),u(!1)})},[]);let h=(e,s)=>{x(e);let n=new Map;s.users.forEach(e=>{n.set(e.id,e)}),t({...s.room,users:{get:e=>{var t,s;return null!==(s=null===(t=n.get(e))||void 0===t?void 0:t.username)&&void 0!==s?s:"-"},get_target_user:e=>s.users.filter(t=>t.id!=e).map(e=>e.username).join("")}})};return(0,n.jsxs)("div",{className:"overflow-hidden space-y-3",children:[c&&(0,n.jsx)("p",{children:"Loading chat lists."}),r.map((e,t)=>(0,n.jsx)(o,{onSelect:t=>h(t,e),room:{...e.room,users:e.users},index:t,userId:s,selectedItem:d},e.room.id))]})}function d(e){let{right:t,content:s,username:r}=e;return t?(0,n.jsx)("div",{className:"w-full flex justify-end",children:(0,n.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,n.jsx)("div",{className:"max-w-[65%] bg-violet-500 p-3 text-sm rounded-xl rounded-br-none",children:(0,n.jsx)("p",{className:"text-white",children:s})}),(0,n.jsx)("div",{className:"mt-auto",children:(0,n.jsx)(c,{children:r})})]})}):(0,n.jsxs)("div",{className:"flex gap-3 w-full",children:[(0,n.jsx)("div",{className:"mt-auto",children:(0,n.jsx)(c,{color:"rgb(245 158 11)",children:r})}),(0,n.jsx)("div",{className:"max-w-[65%] bg-gray-200 p-3 text-sm rounded-xl rounded-bl-none",children:(0,n.jsx)("p",{children:s})})]})}function x(e){let{data:t,auth:s,users:r}=e,l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{var e;null===(e=l.current)||void 0===e||e.scrollTo(0,l.current.scrollHeight)},[t]),(0,n.jsx)("div",{className:"p-4 space-y-4 overflow-auto",ref:l,children:t.map(e=>(0,n.jsx)(d,{right:e.user_id===s.id,content:e.content,username:r.get(e.user_id)},e.id))})}async function h(e){let{username:t,phone:s}=e;try{return(await fetch("http://localhost:8080/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,phone:s})})).json()}catch(e){return Promise.reject(e)}}async function m(e){let{phone:t}=e;try{return(await fetch("http://localhost:8080/users/phone/"+t)).json()}catch(e){return Promise.reject(e)}}function f(e){let{show:t,setAuth:s}=e,[r,l]=(0,a.useState)(!1),c=()=>{l(e=>!e)};return(0,n.jsx)("div",{className:"".concat(t?"":"hidden"," bg-gradient-to-b from-orange-400 to-rose-400"),children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsxs)("div",{className:"px-8 py-6 mt-4 text-left bg-white  max-w-[400px] w-full rounded-xl shadow-lg",children:[(0,n.jsx)("h3",{className:"text-xl text-slate-800 font-semibold",children:r?"Log in with your phone.":"Create your account."}),r?(0,n.jsx)(e=>{let{setAuth:t}=e,s=async e=>{e.preventDefault();let s=e.target.phone.value;if(""===s)return;let n=await m({phone:s});if(null===n){alert("Failed to create account");return}if(!n.id){alert("Phone number not found ".concat(s));return}t(n)};return(0,n.jsxs)("form",{action:"",className:"mt-4 space-y-2",onSubmit:s,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-light",children:"Phone"}),(0,n.jsx)("input",{required:!0,type:"text",name:"phone",placeholder:"+1111...",className:"w-full px-4 py-2 mt-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-600"})]}),(0,n.jsx)("div",{className:"flex items-baseline justify-between",children:(0,n.jsx)("button",{type:"submit",className:"px-6 py-2 mt-4 text-white bg-violet-600 rounded-lg hover:bg-violet-700 w-full",children:"Submit"})}),(0,n.jsx)("div",{className:"pt-2 space-y-2 text-center",children:(0,n.jsxs)("p",{className:"text-base text-gray-700",children:["Don't have username?"," ",(0,n.jsx)("button",{onClick:c,className:"text-violet-700 font-light",children:"Create"})]})})]})},{setAuth:s}):(0,n.jsx)(e=>{let{setAuth:t}=e,s=async e=>{e.preventDefault();let s=e.target.username.value,n=e.target.phone.value;if(""===s||""===n)return;let r=await h({username:s,phone:n});if(null===r){alert("Failed to create account");return}t(r)};return(0,n.jsxs)("form",{action:"",className:"mt-4 space-y-2",onSubmit:s,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-light",children:"Username"}),(0,n.jsx)("input",{required:!0,type:"text",name:"username",placeholder:"John Doe",className:"w-full px-4 py-2 mt-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-600"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-light",children:"Phone"}),(0,n.jsx)("input",{required:!0,type:"text",name:"phone",placeholder:"+1111...",className:"w-full px-4 py-2 mt-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-600"})]}),(0,n.jsx)("div",{className:"flex items-baseline justify-between",children:(0,n.jsx)("button",{type:"submit",className:"px-6 py-2 mt-4 text-white bg-violet-600 rounded-lg hover:bg-violet-700 w-full",children:"Submit"})}),(0,n.jsx)("div",{className:"pt-2 space-y-2 text-center",children:(0,n.jsxs)("p",{className:"text-base text-gray-700",children:["Already have a username? ",(0,n.jsx)("button",{onClick:c,className:"text-violet-700 font-light",children:"Sign In"})]})})]})},{setAuth:s})]})})})}let p=async e=>{if(e)try{return await fetch("http://localhost:8080/conversations/".concat(e)).then(e=>e.json())}catch(e){console.log(e)}};function g(){let[e,t]=(0,a.useState)(null),[s,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1),[d,h]=function(e,t){let[s,n]=(0,a.useState)(t);return(0,a.useEffect)(()=>{try{let s=window.localStorage.getItem(e),r=s?JSON.parse(s):t;n(r)}catch(e){}},[]),[s,t=>{try{let r=t instanceof Function?t(s):t;n(r),window.localStorage.setItem(e,JSON.stringify(r))}catch(e){}}]}("user",!1),[m,g,j,v]=function(e){let[t,s]=(0,a.useState)(!0),[n,r]=(0,a.useState)([]),l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];s(!1),r(e)},c=e=>{s(!0),p(e).then(l)};return(0,a.useEffect)(()=>c(""),[]),[t,n,r,c]}(0),b=e=>{"IN"===e?r(!0):r(!1)},N=(e,t)=>{j(s=>[...s,{content:e,user_id:t}])},w=function(e){let t=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(null!==t.current)return;t.current=new WebSocket("ws://localhost:8080/ws"),t.current.onopen=()=>console.log("ws opened"),t.current.onclose=()=>console.log("ws closed");let e=t.current;return()=>{e.close()}},[]),(0,a.useEffect)(()=>{t.current&&(t.current.onmessage=t=>{e(t.data)})},[]),e=>{t.current&&t.current.send(e)}}(e=>{try{let t=JSON.parse(e);switch(t.chat_type){case"TYPING":b(t.value[0]);return;case"TEXT":N(t.value[0],t.user_id);return}}catch(e){console.log(e)}}),y=()=>{let t={id:0,chat_type:"TYPING",value:["OUT"],room_id:e.id,user_id:d.id};w(JSON.stringify(t))};return(0,a.useEffect)(()=>o(!d),[d]),(0,n.jsxs)("div",{children:[(0,n.jsxs)(l(),{children:[(0,n.jsx)("title",{children:"Rust with react chat app"}),(0,n.jsx)("meta",{name:"description",content:"Rust with react chat app"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)(f,{show:i,setAuth:h}),(0,n.jsx)("div",{className:"".concat(!d&&"hidden"," bg-gradient-to-b from-orange-400 to-rose-400 h-screen p-12"),children:(0,n.jsxs)("main",{className:"flex w-full max-w-[1020px] h-[700px] mx-auto bg-[#FAF9FE] rounded-[25px] backdrop-opacity-30 opacity-95",children:[(0,n.jsxs)("aside",{className:"bg-[#F0EEF5] w-[325px] h-[700px] rounded-l-[25px] p-4 overflow-auto relative",children:[(0,n.jsx)(u,{onChatChange:e=>{e.id&&(v(e.id),t(e))},userId:d.id}),(0,n.jsx)("button",{onClick:()=>{window.localStorage.removeItem("user"),h(!1)},className:"text-xs w-full max-w-[295px] p-3 rounded-[10px] bg-violet-200 font-semibold text-violet-600 text-center absolute bottom-4",children:"LOG OUT"})]}),(null==e?void 0:e.id)&&(0,n.jsxs)("section",{className:"rounded-r-[25px] w-full max-w-[690px] grid grid-rows-[80px_minmax(450px,_1fr)_65px]",children:[(0,n.jsxs)("div",{className:"rounded-tr-[25px] w-ful",children:[(0,n.jsxs)("div",{className:"flex gap-3 p-3 items-center",children:[(0,n.jsx)(c,{color:"rgb(245 158 11)",children:e.users.get_target_user(d.id)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold text-gray-600 text-base",children:e.users.get_target_user(d.id)}),(0,n.jsx)("div",{className:"text-xs text-gray-400",children:s?"Typing...":"10:15 AM"})]})]}),(0,n.jsx)("hr",{className:"bg-[#F0EEF5]"})]}),m&&e.id&&(0,n.jsx)("p",{className:"px-4 text-slate-500",children:"Loading conversation..."}),(0,n.jsx)(x,{data:g,auth:d,users:e.users}),(0,n.jsx)("div",{className:"w-full",children:(0,n.jsxs)("form",{onSubmit:t=>{t.preventDefault();let s=t.target.message.value;if(""===s)return;if(!e.id){alert("Please select chat room!");return}let n={id:0,chat_type:"TEXT",value:[s],room_id:e.id,user_id:d.id};w(JSON.stringify(n)),t.target.message.value="",N(s,d.id),y()},className:"flex gap-2 items-center rounded-full border border-violet-500 bg-violet-200 p-1 m-2",children:[(0,n.jsx)("input",{onBlur:y,onFocus:()=>{let t={id:0,chat_type:"TYPING",value:["IN"],room_id:e.id,user_id:d.id};w(JSON.stringify(t))},name:"message",className:"p-2 placeholder-gray-600 text-sm w-full rounded-full bg-violet-200 focus:outline-none",placeholder:"Type your message here..."}),(0,n.jsx)("button",{type:"submit",className:"bg-violet-500 rounded-full py-2 px-6 font-semibold text-white text-sm",children:"Sent"})]})})]})]})})]})}}},function(e){e.O(0,[959,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);